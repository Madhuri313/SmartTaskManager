{% extends 'base.html' %}
{% block title %}Tasks{% endblock %}
{% block content %}
<section class="list-grid">
  <aside class="filters">
    <h4>Filters</h4>
    <form method="get">
      <label>Search</label>
      <input name="q" value="{{ request.GET.q }}">
      <label>Tag</label>
      <select name="tag">
        <option value="">All</option>
        {% for t in tags %} <option value="{{ t.name }}" {% if request.GET.tag == t.name %}selected{% endif %}> {{ t.name }} </option> {% endfor %}
      </select>
      <label>Priority</label>
      <select name="priority">
        <option value="">Any</option>
        <option value="H" {% if request.GET.priority == 'H' %}selected{% endif %}>High</option>
        <option value="M" {% if request.GET.priority == 'M' %}selected{% endif %}>Medium</option>
        <option value="L" {% if request.GET.priority == 'L' %}selected{% endif %}>Low</option>
      </select>
      <label>Status</label>
      <select name="status">
        <option value="all">All</option>
        <option value="pending" {% if request.GET.status == 'pending' %}selected{% endif %}>Pending</option>
        <option value="completed" {% if request.GET.status == 'completed' %}selected{% endif %}>Completed</option>
      </select>
      <button class="btn-ghost">Apply</button>
    </form>
  </aside>

  <div class="tasks-area">
    <div class="tasks-header">
      <h2>Tasks</h2>
      <a class="btn" href="{% url 'tasks:task_create' %}">+ New Task</a>
    </div>

    <div class="tasks-list">
      {% for task in tasks %}
        <div class="task-card {% if task.priority == 'H' %} high {% elif task.priority == 'L' %}low{% endif %} {% if task.completed %}done{% endif %}">
          <div class="task-row">
            <div>
              <h3><a href="{% url 'tasks:task_detail' task.pk %}">{{ task.title }}</a></h3>
              <p class="muted small">{{ task.description|truncatechars:120 }}</p>
              <div class="meta">
                {% for tag in task.tags.all %}
                  <span class="chip">{{ tag.name }}</span>
                {% endfor %}
                {% if task.due_date %}<span class="due">Due: {{ task.due_date }}</span>{% endif %}
              </div>
            </div>
            <div class="actions">
              <a href="{% url 'tasks:toggle_complete' task.pk %}" class="icon">{% if task.completed %}Undo{% else %}Done{% endif %}</a>
              <a href="{% url 'tasks:task_edit' task.pk %}" class="icon">Edit</a>
              <a href="{% url 'tasks:task_delete' task.pk %}" class="icon danger">Delete</a>
            </div>
          </div>
        </div>
      {% empty %}
        <p class="muted">No tasks found. Create one!</p>
      {% endfor %}
    </div>
  </div>
</section>
{% endblock %}
